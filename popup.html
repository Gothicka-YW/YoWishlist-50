<!doctype html>
<html>
  <head>
    <meta charset="utf-8"/>
    <title>YoCatalog</title>
  <link rel="stylesheet" href="fonts/fonts.css" />
  <style>
      :root{
        /* Default theme now: Cool Mist */
        --bg:#F2F5F6; /* gradient start */
        --bg-2:#E3E8EA; /* gradient end */
        --fg:#283138;
        --muted:#5A6872;
        --surface:#E3E8EA;
        --surface-2:#D7DDE0;
        --border:#CDD3D6;
        --accent:#507B91;
        --accent-contrast:#ffffff;
        --btn-bg: var(--accent);
        --btn-bg-hover:#436b7c;
        --accent-ring: rgba(80,123,145,.30);
        --btn-border:#2f4d59;
        --input-bg:#ffffff;
        --shadow:0 10px 24px rgba(0,0,0,.12),0 4px 10px rgba(0,0,0,.10);
        --highlight:#3B91B8;
        --metallic:#A9B2B7;
        --btn-grad-start:#6d92a6;
        --btn-grad-mid:#507B91;
        --btn-grad-end:#2f4d59;
        --popup-width:480px;
      }
      /* Themes */
  body.theme-midnight{ --bg:#0f1217; --fg:#e7ecf3; --muted:#a4adba; --surface:#171b22; --surface-2:#1f2430; --border:#2a3240; --accent:#2f71ff; --btn-bg-hover:#1f58d6; --btn-border:#153a8c; --input-bg:#1a202a; --accent-ring: rgba(47,113,255,.30); --btn-grad-start:#5b97ff; --btn-grad-mid:#2f71ff; --btn-grad-end:#1c3aa9; }
  body.theme-yo-pink{ --bg:#fff5f8; --fg:#241421; --muted:#7a5d72; --surface:#ffffff; --surface-2:#ffe9f1; --border:#ffd3e3; --accent:#e91e63; --btn-bg-hover:#c2185b; --btn-border:#8c1440; --input-bg:#fff; --accent-ring: rgba(233,30,99,.30); --btn-grad-start:#ff74a7; --btn-grad-mid:#e91e63; --btn-grad-end:#8c1440; }
  body.theme-emerald{ --bg:#f2fbf6; --fg:#0e1813; --muted:#5b6e64; --surface:#ffffff; --surface-2:#e9f7ef; --border:#cde9da; --accent:#0f9d58; --btn-bg-hover:#0c7a44; --btn-border:#095a33; --input-bg:#fff; --accent-ring: rgba(15,157,88,.28); --btn-grad-start:#36da8f; --btn-grad-mid:#0f9d58; --btn-grad-end:#095a33; }
  body.theme-contrast{ --bg:#ffffff; --fg:#000; --muted:#222; --surface:#ffffff; --surface-2:#f2f2f2; --border:#000; --accent:#000; --btn-bg-hover:#222; --btn-border:#000; --input-bg:#fff; --accent-ring: rgba(0,0,0,.28); --btn-grad-start:#333; --btn-grad-mid:#1a1a1a; --btn-grad-end:#000; }
  /* New eye-friendly themes */
  body.theme-mist{ --bg:#F2F5F6; --fg:#283138; --muted:#5A6872; --surface:#E3E8EA; --surface-2:#D7DDE0; --border:#CDD3D6; --accent:#507B91; --btn-bg-hover:#436b7c; --btn-border:#2f4d59; --input-bg:#ffffff; --accent-ring: rgba(80,123,145,.30); --btn-grad-start:#6d92a6; --btn-grad-mid:#507B91; --btn-grad-end:#2f4d59; --highlight:#3B91B8; }
  body.theme-green-tea{ --bg:#F4F7F4; --fg:#2E382F; --muted:#5A665B; --surface:#E6ECE6; --surface-2:#D9E2D9; --border:#CFD6CF; --accent:#557C5B; --btn-bg-hover:#436449; --btn-border:#2f4033; --input-bg:#ffffff; --accent-ring: rgba(85,124,91,.30); --btn-grad-start:#6c9271; --btn-grad-mid:#557C5B; --btn-grad-end:#2f4033; --highlight:#4D9A66; }
  body.theme-slate-midnight{ --bg:#1F2429; --fg:#E2E6EA; --muted:#A7B1BA; --surface:#2A3036; --surface-2:#22282d; --border:#3B444C; --accent:#5C8FB8; --btn-bg-hover:#4A7BA3; --btn-border:#2d4f6b; --input-bg:#1F252B; --accent-ring: rgba(92,143,184,.32); --btn-grad-start:#6ea2c9; --btn-grad-mid:#5C8FB8; --btn-grad-end:#2d4f6b; --highlight:#4CA2D6; }
  body.theme-autumn-leaf{ --bg:#F7F3EE; --fg:#332820; --muted:#66594F; --surface:#ECE4DA; --surface-2:#E2D9CE; --border:#D8CCBF; --accent:#7C4F33; --btn-bg-hover:#633f29; --btn-border:#4a2d1c; --input-bg:#ffffff; --accent-ring: rgba(124,79,51,.30); --btn-grad-start:#9a6a4d; --btn-grad-mid:#7C4F33; --btn-grad-end:#4a2d1c; --highlight:#C27A3C; }
  body.theme-espresso-cream{ --bg:#F5F1EC; --fg:#2F251F; --muted:#63564D; --surface:#E8E2DA; --surface-2:#DCD4CA; --border:#D5CCBF; --accent:#5A3F30; --btn-bg-hover:#462f24; --btn-border:#382418; --input-bg:#ffffff; --accent-ring: rgba(90,63,48,.32); --btn-grad-start:#7a5a48; --btn-grad-mid:#5A3F30; --btn-grad-end:#382418; --highlight:#A26F42; }
  body.theme-dark-graphite{ --bg:#1E1F22; --fg:#DFE3E7; --muted:#A4ADB5; --surface:#292B2F; --surface-2:#212327; --border:#3A3D42; --accent:#5F6E87; --btn-bg-hover:#4d5a70; --btn-border:#2f3848; --input-bg:#202226; --accent-ring: rgba(95,110,135,.32); --btn-grad-start:#7a89a3; --btn-grad-mid:#5F6E87; --btn-grad-end:#2f3848; --highlight:#4F89C3; }

      *{ box-sizing: border-box; }
      html, body{ margin:0; overflow:hidden; }
      body{
        /* Fixed width for consistent layout across tabs */
        width: var(--popup-width);
        min-width: var(--popup-width);
        max-width: var(--popup-width);
        min-height: 320px;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
        color: var(--fg);
        /* Atmospheric background gradient */
        background: linear-gradient(180deg, var(--bg), var(--bg-2));
  padding: 2px; /* small frame so rounded corners fully visible */
        /* Hide outer scrollbars so the inner card scrolls instead */
        overflow: hidden; /* ensure no outer scrollbars */
      }
      .app{
        position: relative;
        background: var(--surface);
        border-radius: 28px;
        /* Softer, elevated shadow with subtle inner stroke instead of a hard border */
        box-shadow:
          0 14px 30px rgba(0,0,0,.14),
          0 6px 16px rgba(0,0,0,.08),
          inset 0 0 0 1px var(--border);
  padding: 10px 10px 14px 10px;
        overflow: hidden; /* ensure rounded corners feel real */
  /* Scroll inside the rounded card (let popup auto-size up to viewport) */
  max-height: calc(100vh - 4px);
        overflow-y: auto;
        /* Keep scrollbar space reserved to avoid width shifts when switching tabs */
        scrollbar-gutter: stable both-edges;
        overscroll-behavior: contain;
        /* Match card width to popup minus outer padding */
        width: calc(var(--popup-width) - 4px);
      }
      /* Styled, inside-the-card scrollbar matching popup aesthetics */
      .app{ scrollbar-width: thin; scrollbar-color: var(--btn-border) var(--surface-2); }
      .app::-webkit-scrollbar{ width: 12px; height: 12px; }
      .app::-webkit-scrollbar-track{
        background: var(--surface-2);
        border-radius: 12px;
        box-shadow: inset 0 0 0 1px var(--border);
      }
      .app::-webkit-scrollbar-thumb{
        background: var(--accent);
        border-radius: 12px;
        border: 3px solid var(--surface-2); /* inset track gap */
        box-shadow: inset 0 1px 0 rgba(255,255,255,.12), inset 0 -1px 0 rgba(0,0,0,.20);
      }
      .app::-webkit-scrollbar-thumb:hover{ background: var(--btn-bg-hover); }
  /* Header */
  .header-line{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:8px; }
  h1{font-size:24px; margin:0}
  /* brand logo removed */
  /* Header font options */
      .row{display:flex; align-items:center; gap:8px; margin:6px 0}
      input[type="number"], input[type="text"], textarea{
        padding:6px 8px; border:1px solid var(--border); border-radius:8px; background: var(--input-bg); color: var(--fg);
      }
      input[type="number"]{ width: 110px; }
      select{padding:6px 8px; border:1px solid var(--border); border-radius:8px; background: var(--input-bg); color: var(--fg);}
      /* Theme-colored checkboxes & radios */
      input[type="checkbox"], input[type="radio"]{ accent-color: var(--accent); }
      button{
        /* Smaller, more 3D buttons */
        background: linear-gradient(180deg, var(--btn-grad-start), var(--btn-grad-mid) 55%, var(--btn-grad-end));
        color: var(--accent-contrast);
        border: 1px solid var(--btn-border);
        border-radius: 8px;
        padding: 6px 8px;
        font-size: 12px;
        font-weight: 700;
        /* Standard narrower buttons by default */
        width: auto;
        max-width: 200px;
  display: inline-flex;
        align-items: center;
        justify-content: center;
  /* Prevent buttons from expanding in flex rows (override inline flex:1) */
  flex: 0 0 auto !important;
        cursor: pointer;
        box-shadow:
          0 8px 18px rgba(0,0,0,.18),            /* outer depth */
          0 3px 8px rgba(0,0,0,.14),
          inset 0 1px 0 rgba(255,255,255,.16),   /* top highlight */
          inset 0 -1px 0 rgba(0,0,0,.20);        /* bottom edge */
        transition: transform .05s ease, box-shadow .15s ease, filter .15s ease;
        white-space: nowrap;
      }
      /* Allow specific rows to have equally-sized full-width buttons despite the default narrow buttons */
      .btn-grow{ flex: 1 1 0% !important; max-width: none !important; width: 100%; }
      button:hover{
        filter: brightness(1.03) saturate(1.02);
        box-shadow:
          0 10px 22px rgba(0,0,0,.22),
          0 4px 10px rgba(0,0,0,.16),
          inset 0 1px 0 rgba(255,255,255,.20),
          inset 0 -1px 0 rgba(0,0,0,.22);
      }
      button:active{
        transform: translateY(1px);
        box-shadow:
          0 5px 12px rgba(0,0,0,.22),
          0 2px 6px rgba(0,0,0,.18),
          inset 0 2px 0 rgba(0,0,0,.24),
          inset 0 -1px 0 rgba(255,255,255,.10);
      }
      button:focus{ outline: none; }
      button:focus-visible{ box-shadow: 0 0 0 3px var(--accent-ring), 0 6px 14px rgba(0,0,0,.10), 0 2px 6px rgba(0,0,0,.08), inset 0 -1px 0 rgba(0,0,0,.08), inset 0 1px 0 rgba(255,255,255,.10); }
      button[disabled]{ opacity:.65; cursor:not-allowed; filter: saturate(.9) brightness(.98); }
      .muted{font-size:11px;color:var(--muted);margin-top:6px; line-height:1.2}
  /* Drop zone */
  #drop-zone{ display:flex; align-items:center; justify-content:center; text-align:center; padding:10px; border:2px dashed var(--border); border-radius:12px; background: var(--surface-2); color: var(--muted); }
  #images-drop-zone, #av-drop-zone{ display:flex; align-items:center; justify-content:center; text-align:center; padding:10px; border:2px dashed var(--border); border-radius:12px; background: var(--surface-2); color: var(--muted); }
  #drop-zone.dragover{ border-color: var(--accent); color: var(--fg); background: rgba(0,0,0,0.02); }
      /* Tabs */
      #tabs{ gap:6px; margin-bottom:6px }
  #tabs .tab{ background: var(--surface-2); color: var(--fg); border:1px solid var(--border); border-radius:10px; padding:5px 8px; font-weight:700; box-shadow: 0 1px 0 rgba(0,0,0,.05), inset 0 -1px 0 rgba(255,255,255,.06); font-size:12px; max-width: none; flex: 1 1 0% !important; }
  #tabs .tab:hover{ filter: brightness(1.02); }
  #tabs .tab.active{ background: linear-gradient(180deg, var(--btn-grad-start), var(--btn-grad-end)); color: var(--accent-contrast); border-color: var(--btn-border); box-shadow: 0 4px 10px rgba(0,0,0,.12), inset 0 1px 0 rgba(255,255,255,.10); }
  /* ===== Settings compact mode ===== */
  #view-settings .row{ gap:6px; margin:6px 0; }
  #view-settings label{ font-size:12px; }
  #view-settings input[type="text"],
  #view-settings input[type="number"],
  #view-settings textarea,
  #view-settings select{
    padding:6px 8px;
    border-radius:8px;
    font-size:12px;
  }
  #view-settings button{
    padding:6px 8px;
    border-radius:8px;
    font-size:12px;
    flex: 0 0 auto !important;
  }
  /* Cap widths so fields don't span full width unnecessarily */
  #view-settings #saved-cap-select,
  #view-settings #av-cap-select,
  #view-settings #theme-select{ max-width: 220px; }
  /* Keep API key full width for usability */
  #view-settings #imgbb-key{ width: 100%; }
  /* Tighten helper text */
  #view-settings .muted{ font-size:11px; }
  /* Slightly pull Settings up to reduce top whitespace */
  #view-settings{ margin-top: -4px; }
  /* Two-column layout for key Settings selects */
  #view-settings .settings-two-col{ display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); column-gap:10px; row-gap:8px; }
  #view-settings .settings-two-col .row{ margin:0; }
  #view-settings #saved-cap-select,
  #view-settings #av-cap-select,
  #view-settings #theme-select{ max-width: none; width: 100%; }
  /* ===== Avatars visual enhancements ===== */
  #av-grid{ --avatar-card-min:120px; grid-template-columns: repeat(auto-fill, minmax(var(--avatar-card-min), 1fr)); }
  #av-grid .avatar-card{ position:relative; display:flex; flex-direction:column; gap:4px; align-items:stretch; padding:8px 8px 10px; border:1px solid var(--border); border-radius:14px; background: var(--surface-2); font-size:11px; box-shadow: 0 2px 4px rgba(0,0,0,.20), inset 0 0 0 1px rgba(255,255,255,.05); cursor:pointer; transition: box-shadow .18s ease, transform .12s ease, border-color .18s ease; overflow:hidden; }
  #av-grid .avatar-card:hover{ box-shadow: 0 4px 10px rgba(0,0,0,.28), inset 0 0 0 1px rgba(255,255,255,.08); transform: translateY(-2px); }
  #av-grid .avatar-card.selected{ border-color: var(--accent); box-shadow: 0 0 0 2px var(--accent-ring), 0 6px 14px rgba(0,0,0,.32), inset 0 0 0 1px rgba(255,255,255,.10); }
  .avatar-thumb{ width:100%; aspect-ratio:1/1; border-radius:10px; overflow:hidden; background: linear-gradient(135deg, var(--surface) 0%, var(--surface-2) 60%); display:flex; align-items:center; justify-content:center; position:relative; }
  .avatar-thumb img{ width:100%; height:100%; object-fit:cover; display:block; }
  .avatar-placeholder{ font-size:10px; color:var(--muted); padding:4px; text-align:center; }
  .avatar-name{ font-weight:600; font-size:11.5px; line-height:1.15; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
  .group-badge{ display:inline-block; align-self:flex-start; background: var(--accent); color: var(--accent-contrast); font-size:10px; padding:2px 6px; border-radius:20px; font-weight:600; letter-spacing:.3px; box-shadow: 0 2px 4px rgba(0,0,0,.25); }
  .avatar-tags{ display:flex; flex-wrap:wrap; gap:4px; margin-top:2px; }
  .tag-chip{ background: var(--surface); border:1px solid var(--border); font-size:9.5px; padding:2px 5px; border-radius:12px; color: var(--muted); line-height:1.05; max-width:58px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
  .avatar-card input[type=checkbox]{ position:absolute; top:6px; left:6px; width:14px; height:14px; }
  /* Preview panel styling upgrades */
  #av-preview{ position:relative; }
  #av-preview-body{ display:flex; flex-direction:column; gap:8px; }
  #av-preview-body img{ box-shadow: 0 4px 10px rgba(0,0,0,.35); }
  #av-preview-body .meta-row{ display:flex; gap:10px; }
  #av-preview-body .chip-row{ display:flex; flex-wrap:wrap; gap:6px; }
  #av-preview-body .chip-row .tag-chip{ font-size:11px; padding:4px 8px; }
  .avatar-timestamps{ font-size:10px; color: var(--muted); text-align:right; margin-top:-4px; }
  /* Inline notice banner */
  .notice{ display:none; position:relative; margin:6px 0 8px; padding:8px 10px; border-radius:10px; border:1px solid var(--border); background: var(--surface-2); color: var(--fg); box-shadow: 0 1px 0 rgba(0,0,0,.05), inset 0 -1px 0 rgba(255,255,255,.04); font-size:12px; }
  .notice-success{ border-color: #3a7a56; background: rgba(76, 175, 80, .12); }
  .notice-error{ border-color: #8c2f2f; background: rgba(220, 53, 69, .12); }
  .notice-info{ border-color: var(--btn-border); background: rgba(80,123,145,.10); }
  .notice .close{ position:absolute; right:8px; top:6px; cursor:pointer; font-weight:700; opacity:.6; }
    </style>
  </head>
  <body>
    <div class="app">
      <div class="row" id="tabs">
        <button id="tab-home" class="tab active" style="flex:1">Home</button>
        <button id="tab-main" class="tab" style="flex:1">Screen Grab</button>
        <button id="tab-share" class="tab" style="flex:1">Wish Lists</button>
        <button id="tab-avatars" class="tab" style="flex:1">Avatars</button>
        <button id="tab-images" class="tab" style="flex:1">Images</button>
        <button id="tab-settings" class="tab" style="flex:1">Settings</button>
      </div>
      <div id="notice" class="notice"><span id="notice-text"></span><span id="notice-close" class="close">×</span></div>
    <div id="view-home">
      <div class="row" style="flex-direction:column; align-items:stretch; gap:8px">
        <div style="display:flex; align-items:center; justify-content:center;">
          <h2 style="
            margin: 8px 0 6px 0;
            font-size: 34px;
            font-weight: 400;
            font-family: 'Dancing Script', 'Segoe Script', cursive;
            letter-spacing: .6px;
            text-align: center;
            color: var(--accent-contrast);
            text-shadow: 0 2px 14px rgba(0,0,0,.28), 0 1px 4px rgba(0,0,0,.28);
            background: linear-gradient(180deg, var(--btn-grad-start), var(--btn-grad-end));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
          ">Welcome to YoCatalog!</h2>
        </div>
        <div style="display:flex; flex-direction:column; gap:10px; padding:8px; border:1px solid var(--border); border-radius:12px; background: var(--surface-2)">
          <h3 style="margin:0; font-size:16px">Screen Grab</h3>
          <p style="margin:0; font-size:12px; line-height:1.3; color:var(--muted)">Capture your wish list from the <b>yoworld.info/template</b> page. Preview the first N items, precisely <b>pick</b> the card selector if auto-detect misses, then <b>Export (crop)</b> a clean stitched image. Use <b>Restore list</b> to reinstate original content after experimentation. Keep the template page visible during capture for best results.</p>
          <h3 style="margin:0; font-size:16px">Wish Lists</h3>
          <p style="margin:0; font-size:12px; line-height:1.3; color:var(--muted)">Save your captured lists with a title, then quickly <b>copy</b> the direct image URL or forum <b>BBCode</b>. Load, rename, or delete entries, and <b>export/import</b> your library as JSON. Optionally auto-switch here after an export.</p>
          <h3 style="margin:0; font-size:16px">Avatars</h3>
          <p style="margin:0; font-size:12px; line-height:1.3; color:var(--muted)">Build a personal avatar catalog. <b>Upload</b> (or paste/drag) images, add <b>name</b>, <b>group</b>, <b>tags</b>, and a description. Search, sort, bulk select, <b>replace</b> images, and <b>export/import</b> JSON. One click to copy URL or BBCode for forum posts.</p>
          <h3 style="margin:0; font-size:16px">Images</h3>
          <p style="margin:0; font-size:12px; line-height:1.3; color:var(--muted)">A simple image library separate from Wish Lists. <b>Upload</b> (or paste/drag) any image, save with a title, then <b>copy</b> the URL or BBCode. Load, rename, delete entries, and <b>export/import</b> as needed.</p>
        </div>
        <div class="row" style="justify-content:center; margin-top:8px;">
          <a href="https://github.com/Gothicka-YW/YoCatalog/blob/main/YoCatalog_HelpGuide.md" target="_blank" rel="noopener" style="color:inherit; text-decoration:underline">Open Help Guide</a>
        </div>
      </div>
    </div>
    <div id="view-avatars" style="display:none">
      <!-- Create / Replace -->
      <div class="row" style="display:flex; gap:6px; align-items:flex-start">
        <input id="av-name" placeholder="Avatar name" style="flex:1; padding:6px 8px; border:1px solid var(--border); border-radius:8px; background:var(--input-bg); color:var(--fg)" />
        <input id="av-group" placeholder="Group (optional)" style="flex:1; padding:6px 8px; border:1px solid var(--border); border-radius:8px; background:var(--input-bg); color:var(--fg)" />
      </div>
      <div class="row" style="display:flex; gap:6px; align-items:flex-start">
        <input id="av-tags" placeholder="Tags (comma-separated)" style="flex:1; padding:6px 8px; border:1px solid var(--border); border-radius:8px; background:var(--input-bg); color:var(--fg)" />
      </div>
      <div class="row" style="flex-direction:column; align-items:stretch">
        <textarea id="av-desc" rows="2" placeholder="Description (optional)" style="padding:6px 8px; border:1px solid var(--border); border-radius:8px; background:var(--input-bg); color:var(--fg)"></textarea>
      </div>
      <div class="row" style="flex-direction:column; align-items:stretch">
        <div id="av-drop-zone">Drop avatar image here, paste (Ctrl+V), or use Load image file…</div>
      </div>
      <div class="row" style="display:flex; gap:6px">
        <button id="av-btn-load-file" style="flex:1">Load image file…</button>
        <button id="av-btn-clear-image" style="width:auto">Clear image</button>
        <input id="av-file-input" type="file" accept="image/png,image/jpeg,image/webp" style="display:none" />
      </div>
      <div class="row" style="display:flex; gap:10px; align-items:flex-start">
        <div style="flex:1">
          <img id="av-image-preview" alt="preview" style="max-width:100%; border-radius:10px; border:1px solid var(--border); display:none" />
          <input id="av-image-url" readonly style="margin-top:6px; width:100%; padding:6px 8px; border:1px solid var(--border); border-radius:8px; background: var(--input-bg); color: var(--fg)" />
          <div id="av-upload-status" class="muted" style="margin-top:6px; min-height:14px"></div>
          <div style="display:flex; gap:6px; margin-top:6px">
            <button id="av-btn-upload" style="flex:1">Upload & Save</button>
            <button id="av-btn-copy-url" style="width:auto">Copy URL</button>
          </div>
        </div>
        <div id="av-preview" style="flex:1; border:1px solid var(--border); border-radius:10px; padding:8px; background:var(--surface-2)">
          <div class="muted" id="av-preview-empty">Select an avatar to view details.</div>
          <div id="av-preview-body" style="display:none">
            <img id="av-preview-image" alt="avatar" style="max-width:100%; border-radius:10px; border:1px solid var(--border)" />
            <div class="row" style="flex-direction:column; align-items:stretch">
              <label>Name</label>
              <input id="av-meta-name" />
            </div>
            <div class="row" style="display:flex; gap:6px; align-items:flex-start">
              <div style="flex:1">
                <label>Group</label>
                <input id="av-meta-group" />
              </div>
              <div style="flex:1">
                <label>Tags</label>
                <input id="av-meta-tags" placeholder="comma-separated" />
              </div>
            </div>
            <div class="row" style="flex-direction:column; align-items:stretch">
              <label>Description</label>
              <textarea id="av-meta-desc" rows="2"></textarea>
            </div>
            <div class="row" style="display:flex; gap:6px; flex-wrap:wrap">
              <button id="av-btn-save-meta" style="flex:1">Save</button>
              <button id="av-btn-replace" style="flex:1">Replace Image</button>
              <button id="av-btn-copy-url2" style="flex:1">Copy URL</button>
              <button id="av-btn-copy-bb" style="flex:1">Copy BBCode</button>
              <button id="av-btn-download" style="flex:1">Download</button>
              <button id="av-btn-delete" style="width:auto">Delete</button>
            </div>
          </div>
        </div>
      </div>
      <div class="row" style="display:flex; gap:6px; align-items:center">
        <select id="av-group-filter" style="flex:0 0 140px; padding:6px 8px; border:1px solid var(--border); border-radius:8px; background:var(--input-bg); color:var(--fg)"></select>
        <input id="av-search" placeholder="Search name, tags, desc" style="flex:1; padding:6px 8px; border:1px solid var(--border); border-radius:8px; background:var(--input-bg); color:var(--fg)" />
        <select id="av-sort" style="flex:0 0 140px; padding:6px 8px; border:1px solid var(--border); border-radius:8px; background:var(--input-bg); color:var(--fg)">
          <option value="name">Name A–Z</option>
          <option value="updated">Recently Updated</option>
          <option value="created">Recently Added</option>
        </select>
        <div class="muted" id="av-count" style="flex:0 0 auto">—</div>
      </div>
      <div class="row" style="display:flex; gap:6px; align-items:center; flex-wrap:wrap">
        <label style="display:flex; align-items:center; gap:6px; font-size:12px; color:var(--muted)"><input id="av-bulk-toggle" type="checkbox" /> Bulk select</label>
        <button id="av-btn-bulk-delete" style="flex:0 0 auto; width:auto" disabled>Delete selected</button>
        <button id="av-btn-clear-selection" style="flex:0 0 auto; width:auto" disabled>Clear selection</button>
        <label style="display:flex; align-items:center; gap:6px; font-size:12px; color:var(--muted)"><input id="av-compress" type="checkbox" /> Compress PNG (lossless)</label>
      </div>
      <div id="av-grid" style="display:grid; gap:10px"></div>
      <!-- Avatars import/export moved to Settings. -->
    </div>
  <div id="view-main" style="display:none">
    <div class="row">
      <label for="limit">Limit</label>
      <input id="limit" type="number" min="1" max="100" value="50" />
    </div>
    <div class="row">
      <label for="columns">Columns (grid estimate)</label>
      <input id="columns" type="number" min="1" max="10" value="5" />
    </div>
    <div class="row" style="flex-direction:column; align-items:stretch">
      <label for="scope-name">Scope (list title on yoworld.info) — optional</label>
  <input id="scope-name" placeholder="e.g., My Wishlist, Halloween Sale" style="padding:6px 8px; border:1px solid var(--border); border-radius:8px; background: var(--input-bg); color: var(--fg)" />
      <span class="muted">If blank, the tool uses your picked selector or auto-detects.</span>
    </div>
    <div class="row" style="display:flex; gap:6px; align-items:center">
      <button id="btn-preview" class="btn-grow">Preview first N</button>
      <button id="btn-export-crop" class="btn-grow">Export (crop)</button>
      <button id="btn-restore" class="btn-grow">Restore list</button>
    </div>
    <div class="row" style="margin-top:-4px;">
      <span id="start-status" class="muted">Start from: —</span>
    </div>
    <div class="row" style="display:flex; gap:6px">
      <button id="btn-pick" style="flex:1">Pick card selector</button>
      <button id="btn-clear-selectors" style="flex:1">Reset selectors</button>
    </div>
    <div class="row" style="margin-top:-4px;">
      <span class="muted">Tips:
        <br>- On the template page, click <b>"Preview Template"</b> before using Pick card selector so item cards render
        <br>- Keep the template page visible during Crop captures
        <br>- Use <b>Pick card selector</b> if detection misses your grid
        <br>- Set a <b>Scope</b> name to match your list title on the page for more accurate section targeting
      </span>
    </div>
    <div class="row"><button id="btn-open-template">Open template page</button></div>
    </div>
  <div id="view-share" style="display:none">
      <div class="row" style="flex-direction:column; align-items:stretch">
        <label>Saved</label>
        <div style="display:flex; gap:6px">
          <select id="saved-select" style="flex:1"></select>
          <button id="btn-saved-load" style="width:auto">Load</button>
          <button id="btn-saved-delete" style="width:auto">Delete</button>
        </div>
        <div style="display:flex; gap:6px; margin-top:6px">
          <input id="saved-title" placeholder="Save Title" style="flex:1; padding:6px 8px; border:1px solid var(--border); border-radius:8px; background: var(--input-bg); color: var(--fg)" />
          <button id="btn-saved-save" style="width:auto">Save Title</button>
          <button id="btn-saved-rename" style="width:auto">Rename</button>
        </div>
      </div>
      <div class="row" style="flex-direction:column; align-items:stretch">
        <div id="drop-zone">Drop image here, paste (Ctrl+V), or use Load image file…</div>
      </div>
      <div class="row" style="display:flex; gap:6px">
        <button id="btn-load-file" style="flex:1">Load image file…</button>
        <button id="btn-clear-image" style="width:auto">Clear image</button>
        <input id="file-input" type="file" accept="image/png,image/jpeg,image/webp" style="display:none" />
      </div>
      <div class="row" style="flex-direction:column; align-items:stretch">
        <img id="image-preview" alt="preview" style="max-width:100%; border-radius:10px; border:1px solid var(--border); display:none" />
        <span class="muted">Tip: You can load a saved PNG/JPG from anywhere, then Upload to get a shareable URL + forum BBCode.</span>
      </div>
      <div class="row" style="flex-direction:column; align-items:stretch">
        <label>Image URL</label>
        <input id="image-url" readonly style="padding:6px 8px; border:1px solid var(--border); border-radius:8px; background: var(--input-bg); color: var(--fg)" />
        <div id="upload-status" class="muted" style="margin-top:6px; min-height:14px"></div>
        <div style="display:flex; gap:6px; margin-top:6px">
          <button id="btn-upload" style="flex:1">Upload</button>
          <button id="btn-copy-url" style="width:auto">Copy URL</button>
        </div>
      </div>
      <div class="row" style="flex-direction:column; align-items:stretch">
        <label>Forum link (BBCode)</label>
        <label style="display:flex; align-items:center; gap:8px; margin:4px 0 6px 0; font-size:12px; color: var(--muted)">
          <input id="include-title" type="checkbox" checked /> Include title in forum code
        </label>
        <textarea id="forum-link" rows="3" readonly style="padding:6px 8px; border:1px solid var(--border); border-radius:8px; background: var(--input-bg); color: var(--fg)"></textarea>
        <div style="display:flex; gap:6px; margin-top:6px">
          <button id="btn-copy-forum" style="flex:1">Copy forum link</button>
        </div>
        <div id="no-image-hint" class="muted" style="display:none; margin-top:6px">No image URL — upload or attach an image first.</div>
      </div>
    </div>
    <div id="view-images" style="display:none">
      <div class="row" style="flex-direction:column; align-items:stretch">
        <label>Saved Images</label>
        <div style="display:flex; gap:6px">
          <select id="images-saved-select" style="flex:1"></select>
          <button id="images-btn-load" style="width:auto">Load</button>
          <button id="images-btn-delete" style="width:auto">Delete</button>
        </div>
        <div style="display:flex; gap:6px; margin-top:6px">
          <input id="images-saved-title" placeholder="Save Title" style="flex:1; padding:6px 8px; border:1px solid var(--border); border-radius:8px; background: var(--input-bg); color: var(--fg)" />
          <button id="images-btn-save" style="width:auto">Save Title</button>
          <button id="images-btn-rename" style="width:auto">Rename</button>
        </div>
      </div>
      <div class="row" style="flex-direction:column; align-items:stretch">
  <div id="images-drop-zone">Drop image here, paste (Ctrl+V), or use Load image file…</div>
      </div>
      <div class="row" style="display:flex; gap:6px">
  <button id="images-btn-load-file" style="flex:1">Load image file…</button>
        <button id="images-btn-clear-image" style="width:auto">Clear image</button>
        <input id="images-file-input" type="file" accept="image/png,image/jpeg,image/webp" style="display:none" />
      </div>
      <div class="row" style="flex-direction:column; align-items:stretch">
        <img id="images-image-preview" alt="preview" style="max-width:100%; border-radius:10px; border:1px solid var(--border); display:none" />
        <span class="muted">Tip: Upload to get a shareable URL + forum BBCode.</span>
      </div>
      <div class="row" style="flex-direction:column; align-items:stretch">
        <label>Image URL</label>
        <input id="images-image-url" readonly style="padding:6px 8px; border:1px solid var(--border); border-radius:8px; background: var(--input-bg); color: var(--fg)" />
        <div id="images-upload-status" class="muted" style="margin-top:6px; min-height:14px"></div>
        <div style="display:flex; gap:6px; margin-top:6px">
          <button id="images-btn-upload" style="flex:1">Upload</button>
          <button id="images-btn-copy-url" style="width:auto">Copy URL</button>
        </div>
      </div>
      <div class="row" style="flex-direction:column; align-items:stretch">
        <label>Forum link (BBCode)</label>
        <label style="display:flex; align-items:center; gap:8px; margin:4px 0 6px 0; font-size:12px; color: var(--muted)">
          <input id="images-include-title" type="checkbox" checked /> Include title in forum code
        </label>
        <textarea id="images-forum-link" rows="3" readonly style="padding:6px 8px; border:1px solid var(--border); border-radius:8px; background: var(--input-bg); color: var(--fg)"></textarea>
        <div style="display:flex; gap:6px; margin-top:6px">
          <button id="images-btn-copy-forum" style="flex:1">Copy forum link</button>
        </div>
        <div id="images-no-image-hint" class="muted" style="display:none; margin-top:6px">No image URL — upload or attach an image first.</div>
      </div>
      <!-- Close view-images container (was missing) -->
      </div>

      <div id="view-settings" style="display:none">
      <div class="row" style="flex-direction:column; align-items:stretch">
        <p class="muted">Need an imgbb API key for uploads? Create or view your key on imgbb, then paste it below.</p>
        <div style="display:flex; gap:6px">
          <button id="btn-get-imgbb-key" style="flex:1">Get imgbb API key</button>
          <button id="btn-open-help" style="width:auto">Help/Guide</button>
        </div>
      </div>
      <div class="row" style="flex-direction:column; align-items:stretch">
        <label>imgbb API key</label>
        <div style="display:flex; gap:6px">
          <input id="imgbb-key" placeholder="Paste your imgbb API key" style="flex:1; padding:6px 8px; border:1px solid var(--border); border-radius:8px; background: var(--input-bg); color: var(--fg)" />
          <button id="btn-save-imgbb" style="width:auto">Save</button>
          <button id="btn-test-imgbb" style="width:auto">Test key</button>
        </div>
      </div>
      <div class="settings-two-col">
        <div class="row" style="flex-direction:column; align-items:stretch">
          <label>Wish List Max Entries</label>
          <select id="saved-cap-select">
            <option value="10">10</option>
            <option value="25">25</option>
            <option value="50" selected>50</option>
            <option value="100">100</option>
            <option value="unlimited">Unlimited</option>
          </select>
        </div>
        <div class="row" style="flex-direction:column; align-items:stretch">
          <label>Avatar max entries</label>
          <select id="av-cap-select">
            <option value="50">50</option>
            <option value="100" selected>100</option>
            <option value="200">200</option>
            <option value="unlimited">Unlimited</option>
          </select>
        </div>
        <div class="row" style="flex-direction:column; align-items:stretch">
          <label>Theme</label>
            <select id="theme-select">
              <option value="default">Cool Mist (Default)</option>
              <option value="autumn-leaf">Autumn Leaf</option>
              <option value="contrast">High Contrast</option>
              <option value="dark-graphite">Dark Graphite</option>
              <option value="emerald">Emerald</option>
              <option value="espresso-cream">Espresso Cream</option>
              <option value="green-tea">Green Tea</option>
              <option value="midnight">Midnight</option>
              <option value="slate-midnight">Slate Midnight</option>
              <option value="yo-pink">Yo Pink</option>
            </select>
        </div>
      </div>
      <div class="row" style="justify-content:space-between; align-items:center">
        <label style="display:flex; align-items:center; gap:8px; font-size:13px; color:var(--fg)"><input type="checkbox" id="auto-switch-share" checked /> Switch to Wish Lists tab after capture</label>
        <button id="btn-reset-settings" style="width:auto">Reset settings</button>
      </div>
      <div class="row" style="display:flex; gap:6px">
        <button id="btn-export-json" style="flex:1">Export JSON</button>
        <button id="btn-import-json" style="flex:1">Import JSON</button>
        <input id="import-file" type="file" accept="application/json" style="display:none" />
      </div>
    </div>
  <p class="muted">Unofficial fan tool — not affiliated with YoWorld or Big Viking Games. Screen Grab works on yoworld.info/template. • <a href="https://github.com/Gothicka-YW/YoCatalog/blob/main/PRIVACY_POLICY.txt" target="_blank" rel="noopener noreferrer" style="color:inherit; text-decoration:underline">Privacy Policy</a></p>
    </div>
    <script src="popup.js"></script>
  </body>
</html>